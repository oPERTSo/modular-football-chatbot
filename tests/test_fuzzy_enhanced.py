#!/usr/bin/env python3
"""
Test script for enhanced fuzzy matching - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from modules.thai_football_bot import ThaiFootballAnalysisChatbot

def test_fuzzy_matching():
    print("=== Testing Enhanced Fuzzy Matching ===")
    
    # Initialize the chatbot
    chatbot = ThaiFootballAnalysisChatbot()
    
    # Test queries with typos and variations
    test_queries = [
        # Serie A variations
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏≤",      # ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏≤",      # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ã‡∏µ ‡πÅ‡∏ó‡∏ô ‡πÄ‡∏ã
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏∞",      # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏≠‡∏∞ ‡πÅ‡∏ó‡∏ô ‡∏≠‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏∞",      # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ã‡∏µ + ‡∏≠‡∏∞
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ã‡∏£‡∏µ‡∏¢‡∏≠‡∏≤",       # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡∏µ‡∏£‡∏µ‡∏¢‡∏≠‡∏≤",       # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ã‡∏µ + ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢‡∏≠",       # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏≠",       # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ã‡∏µ + ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ã‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤",      # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡πÄ‡∏ã‡∏£‡∏µ‡∏¢ ‡πÅ‡∏¢‡∏Å
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ã‡∏µ‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤",      # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ã‡∏µ‡∏£‡∏µ‡∏¢ ‡πÅ‡∏¢‡∏Å
        
        # Premier League variations
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å",   # ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å",   # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏õ ‡πÅ‡∏ó‡∏ô ‡∏û
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏•‡∏µ‡∏Å",     # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πå
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏•‡∏µ‡∏Å",     # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏õ + ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡πå
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Ñ",   # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏Ñ ‡πÅ‡∏ó‡∏ô ‡∏Å
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Ñ",   # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏õ + ‡∏Ñ
        
        # La Liga variations
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤‡∏•‡∏µ‡∏Å‡∏≤",        # ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤‡∏•‡∏¥‡∏Å‡∏≤",        # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏•‡∏¥ ‡πÅ‡∏ó‡∏ô ‡∏•‡∏µ
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤‡∏•‡∏µ‡∏Å",         # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤‡∏•‡∏¥‡∏Å",         # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏•‡∏¥ + ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤‡∏•‡∏µ‡∏Ñ‡∏≤",        # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏Ñ ‡πÅ‡∏ó‡∏ô ‡∏Å
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏≤‡∏•‡∏¥‡∏Ñ‡∏≤",        # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏•‡∏¥ + ‡∏Ñ
        
        # Bundesliga variations
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤",    # ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤",    # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ö‡∏±‡∏ô ‡πÅ‡∏ó‡∏ô ‡∏ö‡∏∏‡∏ô
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Ñ",     # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏Ñ ‡πÅ‡∏ó‡∏ô ‡∏Å‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Ñ",     # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ö‡∏±‡∏ô + ‡∏Ñ
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Ñ‡∏≤",    # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏Ñ‡∏≤ ‡πÅ‡∏ó‡∏ô ‡∏Å‡∏≤
        "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Ñ‡∏≤",    # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ú‡∏¥‡∏î: ‡∏ö‡∏±‡∏ô + ‡∏Ñ‡∏≤
    ]
    
    print("\nüîç Testing various typos and variations...")
    
    for query in test_queries:
        print(f"\n--- Testing: '{query}' ---")
        
        try:
            # Test league detection
            league_id = chatbot.extract_league_id(query)
            
            # Map league IDs to names
            league_names = {
                39: "‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å",
                140: "‡∏•‡∏≤‡∏•‡∏µ‡∏Å‡∏≤", 
                78: "‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤",
                135: "‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤",
                61: "‡∏•‡∏µ‡∏Å‡πÄ‡∏≠‡∏¥‡∏á"
            }
            
            detected_league = league_names.get(league_id, f"Unknown (ID: {league_id})")
            
            # Test full chat response
            response = chatbot.chat(query)
            has_html_table = '<table' in response.lower()
            
            print(f"‚úÖ Detected League: {detected_league}")
            print(f"‚úÖ HTML Table Generated: {'Yes' if has_html_table else 'No'}")
            
            if has_html_table:
                print(f"üìä Response Preview: {response[:100]}...")
            else:
                print(f"üìù Text Response: {response[:100]}...")
                
        except Exception as e:
            print(f"‚ùå Error: {e}")
            import traceback
            traceback.print_exc()

def test_specific_cases():
    print("\n=== Testing Specific Cases ===")
    
    chatbot = ThaiFootballAnalysisChatbot()
    
    # Test your specific examples
    specific_tests = [
        "‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏≤",
        "‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏≤",
        "‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏∞",
        "‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏∞",
        "‡πÄ‡∏ã‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤",
        "‡∏ã‡∏µ‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤"
    ]
    
    for test in specific_tests:
        print(f"\n--- Testing specific case: '{test}' ---")
        
        try:
            league_id = chatbot.extract_league_id(test)
            if league_id == 135:
                print(f"‚úÖ SUCCESS: Correctly identified as Serie A (ID: 135)")
            else:
                print(f"‚ùå FAILED: Identified as League ID {league_id}")
                
        except Exception as e:
            print(f"‚ùå ERROR: {e}")

if __name__ == "__main__":
    test_fuzzy_matching()
    test_specific_cases()
