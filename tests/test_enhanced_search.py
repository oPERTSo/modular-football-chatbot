#!/usr/bin/env python3
"""
Test Enhanced League Search - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏µ‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
"""

import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from modules.thai_football_bot import ThaiFootballAnalysisChatbot

def test_enhanced_league_search():
    """‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏•‡∏µ‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà"""
    print("üîç ENHANCED LEAGUE SEARCH TEST")
    print("=" * 60)
    
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á bot instance (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API keys ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö fuzzy matching)
    bot = ThaiFootballAnalysisChatbot()
    
    # ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
    test_cases = [
        # ===== Premier League =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å", "Premier League - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏°‡∏ô‡∏¢‡∏π", "Premier League - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•", "Premier League - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©", "Premier League - ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô epl", "Premier League - ‡∏ï‡∏±‡∏ß‡∏¢‡πà‡∏≠"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô premier", "Premier League - ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"),
        
        # ===== La Liga =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏≤‡∏•‡∏µ‡∏Å‡∏≤", "La Liga - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏≠‡∏±‡∏•‡∏°‡∏≤‡∏î‡∏£‡∏¥‡∏î", "La Liga - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ã‡πÇ‡∏•‡∏ô‡∏≤", "La Liga - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡πÄ‡∏õ‡∏ô", "La Liga - ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô laliga", "La Liga - ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"),
        
        # ===== Bundesliga =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤", "Bundesliga - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏≤‡πÄ‡∏¢‡∏¥‡∏£‡πå‡∏ô", "Bundesliga - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏°‡∏∏‡∏ô‡∏î‡πå", "Bundesliga - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏±‡∏ô", "Bundesliga - ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô bundesliga", "Bundesliga - ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"),
        
        # ===== Serie A =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤", "Serie A - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏¢‡∏π‡πÄ‡∏ß‡∏ô‡∏ï‡∏∏‡∏™", "Serie A - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏°‡∏¥‡∏•‡∏≤‡∏ô", "Serie A - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏≠‡∏¥‡∏ï‡∏≤‡∏•‡∏µ", "Serie A - ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô serie a", "Serie A - ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"),
        
        # ===== Ligue 1 =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡∏µ‡∏Å‡πÄ‡∏≠‡∏¥‡∏á", "Ligue 1 - ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏µ‡πÄ‡∏≠‡∏™‡∏à‡∏µ", "Ligue 1 - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏≤‡∏£‡∏µ‡∏™", "Ligue 1 - ‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™", "Ligue 1 - ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ligue 1", "Ligue 1 - ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©"),
        
        # ===== ‡∏•‡∏µ‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏ó‡∏¢‡∏•‡∏µ‡∏Å", "Thai League"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏à‡∏•‡∏µ‡∏Å", "J League"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô", "J League - ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®"),
        
        # ===== ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ú‡∏¥‡∏î =====
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô premiership", "Premier League - ‡∏Ñ‡∏≥‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô la liga", "La Liga - ‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏ö‡∏≤‡∏£‡πå‡∏ã‡πà‡∏≤", "La Liga - ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏°‡∏ô‡∏ã‡∏¥‡∏ï‡∏µ‡πâ", "Premier League - ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô"),
        ("‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå", "Serie A - ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠"),
    ]
    
    print(f"üìä ‡∏ó‡∏î‡∏™‡∏≠‡∏ö {len(test_cases)} ‡∏Å‡∏£‡∏ì‡∏µ...")
    print()
    
    success_count = 0
    
    for i, (query, expected_description) in enumerate(test_cases, 1):
        print(f"{i:2d}. {query}")
        print(f"    Expected: {expected_description}")
        
        try:
            # ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£ extract league
            league_id = bot.extract_league_id(query)
            league_name = bot.get_league_name_from_message(query)
            
            print(f"    Result: {league_name} (ID: {league_id})")
            
            # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if any(keyword in expected_description for keyword in ["Premier", "‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå"]) and league_id == 39:
                print("    ‚úÖ PASS")
                success_count += 1
            elif any(keyword in expected_description for keyword in ["La Liga", "‡∏•‡∏≤‡∏•‡∏µ‡∏Å‡∏≤"]) and league_id == 140:
                print("    ‚úÖ PASS")
                success_count += 1
            elif any(keyword in expected_description for keyword in ["Bundesliga", "‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤"]) and league_id == 78:
                print("    ‚úÖ PASS")
                success_count += 1
            elif any(keyword in expected_description for keyword in ["Serie A", "‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢"]) and league_id == 135:
                print("    ‚úÖ PASS")
                success_count += 1
            elif any(keyword in expected_description for keyword in ["Ligue 1", "‡∏•‡∏µ‡∏Å‡πÄ‡∏≠‡∏¥‡∏á"]) and league_id == 61:
                print("    ‚úÖ PASS")
                success_count += 1
            elif any(keyword in expected_description for keyword in ["Thai", "‡πÑ‡∏ó‡∏¢"]) and league_id == 253:
                print("    ‚úÖ PASS")
                success_count += 1
            elif any(keyword in expected_description for keyword in ["J League", "‡πÄ‡∏à‡∏•‡∏µ‡∏Å"]) and league_id == 188:
                print("    ‚úÖ PASS")
                success_count += 1
            else:
                print("    ‚ö†Ô∏è  PARTIAL/FAIL")
                
        except Exception as e:
            print(f"    ‚ùå ERROR: {e}")
            
        print()
    
    print("=" * 60)
    print(f"üéØ ‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ: {success_count}/{len(test_cases)} ‡∏ú‡πà‡∏≤‡∏ô ({success_count/len(test_cases)*100:.1f}%)")
    print()
    
    # ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    print("üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á:")
    print("   - '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏°‡∏ô‡∏¢‡∏π' ‚Üí ‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å")
    print("   - '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ã‡πÇ‡∏•‡∏ô‡∏≤' ‚Üí ‡∏•‡∏≤‡∏•‡∏µ‡∏Å‡∏≤")
    print("   - '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ö‡∏≤‡πÄ‡∏¢‡∏¥‡∏£‡πå‡∏ô' ‚Üí ‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤")
    print("   - '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏¢‡∏π‡πÄ‡∏ß‡∏ô‡∏ï‡∏∏‡∏™' ‚Üí ‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢ ‡∏≠‡∏≤")
    print("   - '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏õ‡∏µ‡πÄ‡∏≠‡∏™‡∏à‡∏µ' ‚Üí ‡∏•‡∏µ‡∏Å‡πÄ‡∏≠‡∏¥‡∏á")
    print()
    print("üöÄ Enhanced League Search ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!")

if __name__ == "__main__":
    test_enhanced_league_search()
